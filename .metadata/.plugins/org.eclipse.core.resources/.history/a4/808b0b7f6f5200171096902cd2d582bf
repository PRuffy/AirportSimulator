/** 
 * 
 */
package framework

import framework.environment.Graph
import framework.environment.SituatedObject
import framework.environment.QuadTree
import javax.xml.parsers.DocumentBuilderFactory
import javax.xml.parsers.DocumentBuilder
import org.w3c.dom.Document
import org.w3c.dom.Element
import org.w3c.dom.NodeList
import org.w3c.dom.Node
import framework.environment.GraphNode

/** 
 * @author stay
 * 
 */
class CreationOfEnv {
	def createGraph(filename : String, graph : Graph, objTree : QuadTree<SituatedObject>){
		try{
			
			//Initialisation du lecteur de xml
			var dbFactory : DocumentBuilderFactory
			dbFactory = DocumentBuilderFactory.newInstance()
			
			var dBuilder : DocumentBuilder
			dBuilder = dbFactory.newDocumentBuilder()
			
			var doc : Document
			doc = dBuilder.parse(filename)
			
			doc.getDocumentElement().normalize()
			
			System.out.println("Root Element :" + doc.getDocumentElement().getNodeName())
			
			var nodeList : NodeList
			nodeList = doc.getElementsByTagName("node")//Récupération des information sur les nodes
			
			var edgeList : NodeList
			edgeList =  doc.getElementsByTagName("edge")//Récupération des information sur les edges
			
			System.out.println("------------------------")
			
			var i : int
			//Travail sur les node
			for(i=0; i<nodeList.getLength;i++){
				//Récupération d'un bloc <node></nodes>
				var node : Node
				node = nodeList.item(i)
				
				System.out.println("\n Current Element :" + node.getNodeName())
				
				if(node.getNodeType()=== Node.ELEMENT_NODE){
					var graphNode = new GraphNode()

					var eElement : Element
					eElement = node as Element
					
					graphNode.setId(eElement.getAttribute("id").toString())
					graphNode.setName(eElement.getElementsByTagName("name").item(0).getTextContent().toString)
					
					var eCoordinate : NodeList
					eCoordinate = eElement.getElementsByTagName("coordinates")
					
					var point1 : Node
					var point2 : Node
					
					point1.eCoordinate.item(0)
					point2.eCoordinate.item(1)
					
					System.out.println("Node id: "+ eElement.getAttribute("id"))
					System.out.println("Node name : "+ eElement.getElementsByTagName("name").item(0).getTextContent())
					System.out.println("Node coordinate :"+ eElement.getElementsByTagName("coordinates").item(0).getTextContent())
					
					graph.addNode(graphNode)
				}
			}
			
		}catch(e : Exception){
			e.printStackTrace()
		}
		
	}
}
